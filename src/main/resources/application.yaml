# Настройки сервера (общие)
server:
  # Порт, на котором будет работать приложение
  # В dev может быть 8080, в prod можно изменить через профиль
  port: 8080

  # Настройки обработки ошибок
  error:
    # Включить детальную информацию об ошибках в ответе
    # В prod лучше отключить (переопределим в application-prod.yml)
    include-message: always
    include-stacktrace: never

spring:
  profiles:
    # ------------------------------------------------------------------------------
    # ПРОФИЛЬ ПО УМОЛЧАНИЮ
    # При запуске приложения будет использоваться профиль 'dev'
    # Можно переопределить через: --spring.profiles.active=prod
    # ------------------------------------------------------------------------------
    active: dev

  # ------------------------------------------------------------------------------
  # НАЗВАНИЕ ПРИЛОЖЕНИЯ
  # Отображается в логах и может использоваться для идентификации
  # ------------------------------------------------------------------------------
  application:
    name: freestyle-libre-telegram-bot

  # ------------------------------------------------------------------------------
  # НАСТРОЙКИ JPA / HIBERNATE (общие для всех профилей)
  # ------------------------------------------------------------------------------
  jpa:
    # Hibernate properties (дополнительные настройки)
    properties:
      hibernate:
        # Формат SQL в логах (если show-sql: true)
        # true = красиво отформатированный SQL
        # false = SQL в одну строку
        format_sql: true

        # Использовать JDBC batch для вставки/обновления
        # Повышает производительность при массовых операциях
        jdbc:
          batch_size: 20

        # Стратегия генерации ID
        # Использует sequence для PostgreSQL (эффективнее чем IDENTITY)
        id:
          new_generator_mappings: true

        # Включить кеш второго уровня (entity cache)
        # false, так как мы используем Caffeine для кеширования токенов
        cache:
          use_second_level_cache: false

  # ------------------------------------------------------------------------------
  # НАСТРОЙКИ LIQUIBASE
  # Система управления миграциями базы данных
  # ------------------------------------------------------------------------------
  liquibase:
    # Включить Liquibase (будет применять миграции при старте)
    enabled: true

    # Путь к главному файлу changelog (список всех миграций)
    change-log: classpath:db/changelog/db.changelog-master.xml

    # Контекст выполнения (можно фильтровать миграции по контексту)
    # Оставляем пустым = выполнять все миграции
    contexts: ""

    # Схема базы данных для таблицы истории миграций Liquibase
    # По умолчанию используется public схема
    default-schema: public

  # ------------------------------------------------------------------------------
  # НАСТРОЙКИ КЕШИРОВАНИЯ
  # Используем Caffeine - высокопроизводительный Java кеш
  # ------------------------------------------------------------------------------
  cache:
    # Тип кеша
    type: caffeine

    # Список имен кешей, которые будут созданы
    cache-names:
      - libreTokenCache # Кеш для JWT токенов LibreView API

    # Настройки Caffeine кеша
    caffeine:
      # Спецификация кеша для токенов
      # maximumSize=100 - максимум 100 записей в кеше
      # expireAfterWrite=180d - токен удаляется из кеша через 180 дней после записи
      spec: maximumSize=100,expireAfterWrite=180d

  # ------------------------------------------------------------------------------
  # НАСТРОЙКИ ПЛАНИРОВЩИКА ЗАДАЧ
  # Для периодической проверки уровня глюкозы
  # ------------------------------------------------------------------------------
  task:
    scheduling:
      # Включить поддержку @Scheduled аннотаций
      enabled: true

      # Размер пула потоков для планировщика
      # 5 потоков достаточно для нескольких периодических задач
      pool:
        size: 5

# ==============================================================================
# НАСТРОЙКИ TELEGRAM БОТА
# ==============================================================================
telegram:
  bot:
    # Токен бота, полученный от @BotFather
    # ВАЖНО: В production используй переменную окружения!
    # Формат: ${ПЕРЕМЕННАЯ:значение_по_умолчанию}
    # Если переменная TELEGRAM_BOT_TOKEN не задана, использует значение после ':'
    token: ${TELEGRAM_BOT_TOKEN:8339753624:AAHrV8c9dQMzKiCjsHNn8Q8q7afoETmGEPo}

    # Имя бота (username без @)
    # Например: FreestyleLibreBot
    username: ${TELEGRAM_BOT_USERNAME:testlibre3_bot}

# ==============================================================================
# НАСТРОЙКИ LibreView API
# ==============================================================================
libreview:
  api:
    # Базовый URL для LibreView API
    base-url: https://api.libreview.ru

    # Эндпоинты API
    endpoints:
      # Авторизация (получение JWT токена)
      login: /llu/auth/login

      # Получение списка подключенных пациентов
      connections: /llu/connections

      # Получение данных глюкозы для конкретного пациента
      # {patientId} будет заменен на реальный ID пациента
      graph: /llu/connections/{patientId}/graph

    # Заголовки для запросов к API
    headers:
      product: llu.android
      version: 4.16.0
      accept: application/json
      content-type: application/json

# ==============================================================================
# НАСТРОЙКИ МОНИТОРИНГА ГЛЮКОЗЫ
# ==============================================================================
glucose:
  monitoring:
    # Интервал проверки уровня глюкозы (в минутах)
    # По умолчанию: каждые 5 минут
    check-interval-minutes: 5

    # Пороговые значения по умолчанию (в ммоль/л)
    default-thresholds:
      # Нижний порог (гипогликемия)
      low: 3.9

      # Верхний порог (гипергликемия)
      high: 10.0

# ==============================================================================
# НАСТРОЙКИ ЛОГИРОВАНИЯ
# ==============================================================================
logging:
  # Уровни логирования по умолчанию
  level:
    # Корневой уровень для всех логгеров
    root: INFO

    # Уровень для Spring Framework
    org.springframework: INFO

    # Уровень для Hibernate (JPA)
    org.hibernate: INFO

    # Уровень для твоих пакетов (замени на свой package)
    # DEBUG покажет детальную информацию о работе приложения
    com.jabes.librebot: DEBUG

    # Уровень для Telegram Bots API
    org.telegram.telegrambots: INFO

  # Паттерн вывода логов в консоль
  pattern:
    # Формат: [Дата Время] [Уровень] [Поток] Класс : Сообщение
    console: "%d{yyyy-MM-dd HH:mm:ss} [%level] [%thread] %logger{36} : %msg%n"

# ==============================================================================
# ДОПОЛНИТЕЛЬНЫЕ НАСТРОЙКИ
# ==============================================================================

# Настройки управления приложением через Spring Boot Actuator (опционально)
management:
  endpoints:
    web:
      # Базовый путь для endpoints
      base-path: /actuator

      # Какие endpoints доступны
      exposure:
        # Включить только health и info
        include: health,info

  # Настройки health endpoint
  endpoint:
    health:
      # Показывать детальную информацию о здоровье приложения
      # when-authorized = только авторизованным пользователям
      # always = всегда показывать
      # never = никогда не показывать детали
      show-details: when-authorized